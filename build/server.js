// Generated by CoffeeScript 1.7.1
var americano, application, controller, init;

americano = require('americano');

init = require('./server/initialize');

controller = require('./server/lib/controller');

application = module.exports = function(callback) {
  var options;
  options = {
    name: 'controller',
    port: process.env.PORT || 9002,
    host: process.env.HOST || "127.0.0.1",
    root: __dirname
  };
  init.init((function(_this) {
    return function() {};
  })(this));
  init.autostart((function(_this) {
    return function(err) {
      console.log(err);
      if (err == null) {
        return americano.start(options, callback);
      } else {
        console.log(err);
        return callback();
      }
    };
  })(this));
  process.on('uncaughtException', function(err) {
    return console.log(err);
  });
  return process.on('exit', function(code) {
    return controller.stopAll((function(_this) {
      return function() {
        return process.exit(code);
      };
    })(this));
  });
};

if (!module.parent) {
  application();
}
