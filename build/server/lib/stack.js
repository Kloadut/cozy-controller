// Generated by CoffeeScript 1.8.0
var config, fs;

fs = require('fs');

config = require('./conf').get;

module.exports.addApp = (function(_this) {
  return function(app, callback) {
    console.log("add App");
    console.log(config('file_sack'));
    return fs.readFile(config('file_stack'), 'utf8', function(err, data) {
      try {
        data = JSON.parse(data);
      } catch (_error) {
        data = {};
      }
      data[app.name] = app;
      return fs.open(config('file_stack'), 'w', function(err, fd) {
        return fs.write(fd, JSON.stringify(data), 0, data.length, 0, callback);
      });
    });
  };
})(this);

module.exports.removeApp = (function(_this) {
  return function(name, callback) {
    return fs.readFile(config('file_stack'), 'utf8', function(err, data) {
      try {
        data = JSON.parse(data);
      } catch (_error) {
        data = {};
      }
      delete data[name];
      return fs.open(config('file_stack'), 'w', function(err, fd) {
        return fs.write(fd, JSON.stringify(data), 0, data.length, 0, callback);
      });
    });
  };
})(this);
